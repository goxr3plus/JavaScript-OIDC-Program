<!-- 
 Copyright 2017 The MIT Internet Trust Consortium
 
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
 
   http://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<script type="text/html" id="tmpl-token-table">
    <div class="well well-small">
        <button class="btn btn-small refresh-table"><i class="icon-refresh"></i> <span data-i18n="common.refresh">Refresh</span></button> &nbsp;
    </div>

    <!-- Twitter like Table for Clients and their Tokens-->
    <table id="twitter-table" class="table table-hover table-striped">
        <thead>
            <tr>
                <!--                <th data-i18n="common.client"></th>
                                <th data-i18n="token.token-table.token-info">Token Information</th>
                                 <th data-i18n="common.expires">Expires</th>
                                 <th></th> -->
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>


    <!-- -----------------Useful information--------------------- -->
    <!--    <div><p data-i18n="token.token-table.text-refresh">Refresh tokens are usually long-lived and provide clients with the ability to get new access tokens without end-user involvement.</p></div>
        <div><p data-i18n="token.token-table.text">Access tokens are usually short-lived and provide clients with access to specific resources. 
                ID Tokens are specialized access tokens to facilitate log on using OpenID Connect.</p></div>-->

    <div id="refresh-token-table-empty" class="alert alert-info" data-i18n="token.token-table.no-refresh">
        There are no active refresh tokens.
    </div>

    <!-- -----------------REFRESH TOKENS TABLE--------------------- -->
    <div class="pagination paginator-refresh"></div>
    <table id="refresh-token-table" class="table table-hover table-striped">
        <thead>
            <tr>
                <th data-i18n="common.client"></th>
                <!-- <th data-i18n="token.token-table.token-info">Token Information</th>
                 <th data-i18n="common.expires">Expires</th>
                 <th></th>  -->
        </thead>
        <tbody>
        </tbody>
    </table>
    <!-- -----------------ACCESS TOKENS--------------------- -->


    <div id="access-token-table-empty" class="alert alert-info" data-i18n="token.token-table.no-access">
        There are no active access tokens.
    </div> 

    <!-- -----------------ACCESS TOKENS TABLE--------------------- -->
    <div class="pagination paginator-access"></div>
    <table id="access-token-table" class="table table-hover table-striped table-responsive">
        <thead>
            <tr>
                <th data-i18n="common.client"></th>
                <!-- <th data-i18n="token.token-table.token-info">Token Information</th>
                 <th data-i18n="common.expires">Expires</th>
                 <th></th>     -->     
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <div class="well well-small">
        <button class="btn btn-small refresh-table"><i class="icon-refresh"></i> <span data-i18n="common.refresh">Refresh</span></button> &nbsp; 
    </div>
</script>



<!------------- BOTH REFRESH AND ACCESS TOKEN TABLE SCRIPTS ------------>
<script type="text/html" id="tmpl-twitter-table-tokens">
    <% var refreshCounter = 0;
    _.each(refresh.models,function (refreshToken,index){ 
    if(refreshToken.get('clientId') === client.clientId )
    ++refreshCounter;          
    });

    var accessTokenCounter = 0;
    _ .each(access.models,function (accessToken,index){ 
    if(accessToken.get('clientId') === client.clientId )
    ++accessTokenCounter;
    });
    %>

    <!-- Show Client only if he has Tokens -->
    <% if(accessTokenCounter !=0 || refreshCounter!=0 ) %>   
    <td>   
        <div class="row-fluid">
            <div class="span12" >
                <button class="btn btn-danger btn-revokeAll btn-md pull-right"><i class="icon-trash icon-white"></i><span>Revoke All</span></button> 

                <!-- Add the user image --->
                <img src=" <%- client.logoUri != null ? client.logoUri : 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/300px-No_image_available.svg.png' %>" class="img-thumbnail" width="60" height="60"> 


                <b><%- client.clientName != null ? client.clientName : ( client.clientId.substr(0,8) + '...' ) %></b>


                <!-- Total Refresh and Access Tokens -->
                <span class="label label-important"><%- refreshCounter %> </span> 
                <span class="label label-success"><%- accessTokenCounter %> </span>   



                <!-- Client Description -->   
                <h6 style="margin-left:7%"><%- client.clientDescription != null ? client.clientDescription : 'No description provided for this user'%></h6>


                <!-- Show more Button -->
                <% if(accessTokenCounter !=0 || refreshCounter!=0 ) %>
                <button type="button" style="margin-left:41%" class="btn btn-info" data-toggle="collapse" data-target="#<%- client.clientId %>">Show Tokens<i class="icon-arrow-down icon-white"></i></button>
                <div id="<%- client.clientId %>" class="collapse" style="padding-left:15px;">
                    <div class="card card-block">
                        <!-- Table that holds the access tokens -->
                        <table id="client<%- client.clientId %>-token-table" class="table table-hover table-striped">
                            <thead>
                                <tr>
                                    <!--                                <th> Refresh Token</th>
                                                                    <th data-i18n="token.token-table.token-info">Token Information</th>
                                                                    <th data-i18n="common.expires">Expires</th>
                                                                    <th></th>-->
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                <%  %>
            </div>
        </div>
    </td>
</script>


<!------------- REFRESH TOKEN SCRIPTS ------------>
<script type="text/html" id="tmpl-refresh-token">
    <td>
        <div class="row-fluid">
            <div class="span12" >
                <span class="label label-important" title="This is a refresh token">Refresh Token</span>
                <span class="badge badge-success" title="Number of associated access tokens"><%- accessTokenCount %></span>

                <!-- Revoke Button -->
                <button class="btn btn-danger btn-delete pull-right"><i class="icon-trash icon-white"></i> <span data-i18n="common.revoke">Revoke</span></button>

                <!-- Show Token Value -->        
                <div class="input-group">
                    <code class="token-substring <%- token.id %>" style="cursor: pointer" data-i18n="[title]token.token-table.click-to-display" title="Click to display full token value"><%- token.value.substr(0,27) %> ...</code>
                    <input type="text" readonly style="cursor: text" class="token-full <%- token.id %> input-xxlarge" value="<%- token.value %>" />  
                    <span class="input-group-addon"><i class="icon-share"></i></span>
                </div>

                <!-- When it expires -->
                Expires : <%- formattedExpiration %>

                <!-- Scope List-->
                <div class="scope-list pull-right"></div>
                <!--If it has any access tokens create the table else not-->
                <% if(accessTokenCount > 0 ) %>
                <button type="button" class="btn btn-success btn-sm" data-toggle="collapse" data-target="#<%- token.id %>" style="margin-left:45%; margin-right:45%;">Access Tokens<i class="icon-arrow-down icon-white"></i></button>      
                <%  %>
            </div>
        </div>
        <div id="<%- token.id %>" class="collapse">
            <!-- Table that holds the access tokens -->
            <table id="refresh<%- client.clientId %><%- token.id %>-token-table" class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th>Access Tokens</th>
                        <th data-i18n="token.token-table.token-info">Token Information</th>
                        <th data-i18n="common.expires">Expires</th>
                        <th>Revoke </th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </td>
</script>


<!--- ---------- ACCESS TOKEN SCRIPTS ---------- -->
<script type="text/html" id="tmpl-access-token">
    <td>
        <!--<span title="<%- client.clientId %>" style="font-weight:bold"><%- client.clientName != null ? client.clientName : ( client.clientId.substr(0,8) + '...' ) %></span>-->
        <!--<div class="client-more-info-block"> More Client Info</div>-->        
        <!--        <div>
                    <span class="label label-info"> Token id = <%- token.id %></span>   
                </div>-->

        <span class="label label-success" title="This is an access token"><i class="icon-bookmark icon-white"></i>Access Token</span>
        <!--<span class="label label-important" title="This is an access token">ID = <%- token.id %></span>-->



        <!--        <% if (token.refreshTokenId != null) { %>
                <br />
                <span class="label label-important" title="This access token was issued with an associated refresh token." data-i18n="[title]token.token-table.associated-refresh">+ <i class="icon-time icon-white"></i> Refresh Token </span>
                <% } %>-->
    </td>

    <td>
        <div class="token-value">
            <code class="token-substring <%- token.id %>+<%- token.refreshTokenId %>" style="cursor: pointer" data-i18n="[title]token.token-table.click-to-display" title="Click to display full token value"><%- token.value.substr(0,27) %> ...</code>
            <input type="text" readonly style="cursor: text" class="token-full <%- token.id %>+<%- token.refreshTokenId %> input-xxlarge" value="<%- token.value %>" />
        </div>
        <div class="scope-list"></div>
    </td>

    <td>
        <%- formattedExpiration %>
    </td>

    <td>
        <button class="btn btn-danger btn-delete pull-right"><i class="icon-trash icon-white"></i> <span data-i18n="common.revoke">Ouh Revoke</span></button>
    </td> 
</script>

